{% extends 'base.html' %}

{% load static %}
{% load crispy_forms_tags %}

{% block titulo %}
Painel / {{ SITE_NAME }}
{% endblock %}

{% block head %}
{% endblock %}

{% block content %}

<div class="container-xxl text-center text-justify my-1">

    <p class="text-start fw-bold">Slots:</p>
    <div class="px-2 py-2 bg-black bg-opacity-50 border border-secondary rounded bg-gradient text-dark">
        <div class="z-10 h-full  md:py-0 text-gray-100 text-center flex items-center flex-col">

            <p class="text-start">
                Cada slot abaixo permite cadastrar um im√≥vel. Voc√™ pode criar mais slots, que custar√£o um ticket por
                m√™s cada. Voc√™ recebeu 50 tickets para usar; para obter mais, clique no bot√£o 'loja de tickets'
                logo abaixo; comprando-os voc√™ ajuda a manter o site no ar, mais seguro e atualizado, obrigado! üòÄ<br>
                Im√≥veis desabilitados n√£o poder√£o receber registros de contratos nem registros de pagamentos em seus
                contratos.
            </p>

            <div class="container g-0 mb-1">
                <div class="d-flex items-center justify-content-end">
                    <div class="mx-1">
                        <button type="button" class="btn btn-sm btn-primary">Loja üè¨</button>
                    </div>
                    <div>
                    <span class="badge bg-secondary position-relative">
                        <h1 class="fs-4">Tickets üé´</h1>
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                            <h1 class="fs-5">{{ tickets }}</h1>
                            <span class="visually-hidden">Tickets</span>
                        </span>
                    </span>
                    </div>
                </div>
            </div>

            <div class="row g-2">

                {% for slot in slots %}
                <div class="card bg-black bg-opacity-100 {{ slot.borda }} h-100" style="cursor:default;">

                    <div class="card-head">

                        <div class="container text-center">
                            <div class="row align-items-start">

                                <div class="col-1 align-self-center">
                                    <h1 class="text-start">{{ forloop.counter }}</h1>
                                </div>

                                <div class="col-4 d-flex align-items-center align-self-center">
                                    {% if slot.imovel %}
                                    {% if slot.ativado %}
                                    Im√≥vel atual: <span class="badge text-bg-primary">{{ slot.imovel }}</span>
                                    {% else %}
                                    Im√≥vel atual: <span class="badge text-bg-warning">{{ slot.imovel }}</span>
                                    {% endif %}
                                    {% else %}
                                    Im√≥vel atual: <span class="badge text-bg-info">Slot vazio</span>
                                    {% endif %}
                                </div>

                                {% if slot.gratuito %}
                                <div class="col-7">
                                    Gr√°tis
                                </div>

                                {% else %}
                                <div class="col-1 align-self-center">
                                    üé´ {{ slot.tickets }}
                                </div>
                                <div class="col-2 align-self-center">
                                    Criado: {{ slot.criado_em|date:"d/m/Y" }}
                                </div>
                                <div class="col-2 align-self-center">
                                    {% if slot.ativado %}
                                    <h1>Vencim.: {{ slot.vencimento|date:"d/m/Y" }}</h1>
                                    {% else %}
                                    <h1 class="text-warning">Venceu em: {{ slot.vencimento|date:"d/m/Y" }}</h1>
                                    {% endif %}
                                </div>
                                <div class="col-1">

                                    <a data-bs-toggle="modal" data-bs-target="#adicionar_tickets{{ slot.pk }}"
                                       class="dropdown-item text-center">
                                        <button type="button" class="btn btn-sm btn-secondary" title="Adicionar ticket">
                                            ‚ûïüé´
                                        </button>
                                    </a>

                                </div>
                                {% if slot.imovel %}
                                <div class="col-1">
                                    <button type="button" class="btn btn-sm btn-secondary" title="Apagar" disabled>‚ùå
                                    </button>
                                </div>
                                {% else %}
                                <div class="col-1">

                                    <a data-bs-toggle="modal" data-bs-target="#apagar_slot{{ slot.pk }}"
                                       class="dropdown-item text-center">
                                        <button type="button" class="btn btn-sm btn-secondary" title="Apagar">
                                            ‚ùå
                                        </button>
                                    </a>

                                </div>
                                {% endif %}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                {% endfor %}

                <div class="d-flex items-center justify-content-between">
                    <div class="my-3 mx-3">
                        <a data-bs-toggle="modal" data-bs-target="#adicionar_slot"
                           class="dropdown-item text-center">
                            <button class="bg-blue-700 text-white p-1 px-3 rounded-md">
                                ‚ûï Adicionar Slot
                            </button>
                        </a>
                    </div>
                    <div class="my-3 mx-3">
                        <a data-bs-toggle="modal" data-bs-target="#adicionar_tickets_todos"
                           class="dropdown-item text-center">
                            <button type="button" class="btn btn-sm btn-secondary"
                                    title="Adicionar tickets em todos os slots">
                                ‚ûïüé´ em todos os Slots
                            </button>
                        </a>
                    </div>
                </div>

            </div>


        </div>
    </div>
</div>

<div class="modal fade" id="adicionar_slot" tabindex="-1" aria-labelledby="ADICIONAR_SLOT" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-dark border border-black text-white">

            <div class="modal-header text-center flex items-center flex-col">
                <h1 class="fs-3">Adicionar slot</h1>
            </div>

            <div class="modal-body text-center items-center">
                <h1 class="fs-5">Isso ir√° consumir um ticket üé´</h1>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar
                </button>
                <a href="{% url 'home:Add Slot' %}">
                    <button type="button" class="btn btn-primary">Confirmar
                    </button>
                </a>
            </div>

        </div>
    </div>
</div>

{% for slot in slots %}
<div class="modal fade" id="apagar_slot{{ slot.pk }}" tabindex="-1" aria-labelledby="APAGAR_SLOT" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-dark border border-black text-white">

            <div class="modal-header text-center flex items-center flex-col">
                <h1 class="fs-3">Apagar slot</h1>
            </div>

            <div class="modal-body text-center items-center">
                <h1 class="fs-5">Deseja mesmo apagar este slot? Voc√™ perder√° os tickets dele.</h1>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar
                </button>
                <a href="{% url 'home:Apagar Slot' slot.pk %}">
                    <button type="button" class="btn btn-primary">Confirmar
                    </button>
                </a>
            </div>
        </div>
    </div>
</div>
{% endfor %}

<div class="modal fade" id="adicionar_tickets_todos" tabindex="-1" aria-labelledby="ADICIONAR_TICKETS_TODOS"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-dark border border-black text-white">

            <form method="POST" action="{% url 'home:Adicionar Ticket Todos' %}">
                {% csrf_token %}

                <div class="modal-header text-center flex items-center flex-col">
                    <h1 class="fs-3">Adicionar tickets em todos os slots</h1>
                </div>
                <div class="modal-body d-flex flex-column text-center items-center">
                    <div>
                        <h1 class="fs-5">Quantos tickets em cada slot?</h1>
                    </div>
                    <div class="w-15 py-2">
                        {{ form.tickets_qtd|as_crispy_field }}
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    <button type="submit" class="btn btn-primary">Confirmar</button>
                </div>

            </form>
        </div>
    </div>
</div>

{% for slot in slots %}
<div class="modal fade" id="adicionar_tickets{{ slot.pk }}" tabindex="-1" aria-labelledby="ADICIONAR_TICKETS"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-dark border border-black text-white">

            <form method="POST" action="{% url 'home:Adicionar Ticket' slot.pk %}">
                {% csrf_token %}

                <div class="modal-header text-center flex items-center flex-col">
                    <h1 class="fs-3">Adicionar tickets</h1>
                </div>
                <div class="modal-body d-flex flex-column text-center items-center">
                    <div>
                        <h1 class="fs-5">Quantos tickets neste slot?</h1>
                    </div>
                    <div class="w-15 py-2">
                        {{ form.tickets_qtd|as_crispy_field }}
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    <button type="submit" class="btn btn-primary">Confirmar</button>
                </div>

            </form>
        </div>
    </div>
</div>
{% endfor %}

{% endblock %}